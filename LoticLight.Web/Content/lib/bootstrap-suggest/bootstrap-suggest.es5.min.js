"use strict";(function(n){if(typeof define=="function"&&define.amd)define(["jquery"],n);else if(typeof exports=="object"&&typeof module=="object")n(require("jquery"));else if(window.jQuery)n(window.jQuery);else throw new Error("Not found jQuery.");})(function(n){function et(n,t){window.console&&window.console.trace&&(console.trace(n),t&&console.trace(t))}function f(n){return n.data()}function e(n,t){return t!==undefined?n.attr("alt",t):n.attr("alt")}function o(n,t){return t!==undefined?n.attr("data-id",t):n.attr("data-id")}function k(n,t,i){if(t&&t.key){var u=i.separator||",",r;i&&i.multiWord?(r=n.val().split(u),r[r.length-1]=t.key,n.val(r.join(u)).focus()):o(n,t.id).val(t.key).focus();n.trigger("onSetSelectValue",[t,(i.data.value||i._lastData.value)[t.index]])}}function h(n,t,i){var u,r;if(t.is(":visible"))return u=n.parent(),i.autoDropup&&setTimeout(function(){l.height()+l.scrollTop()-n.offset().top<t.height()&&n.offset().top>t.height()+l.scrollTop()?u.addClass("dropup"):u.removeClass("dropup")},10),r={},i.listAlign==="left"?r={left:n.siblings("div").width()-u.width(),right:"auto"}:i.listAlign==="right"&&(r={left:"auto",right:0}),w&&!i.showBtn&&(u.hasClass("dropup")?(r.top="auto",r.bottom=u.height()):(r.top=u.height(),r.bottom="auto")),i.autoMinWidth||(r.minWidth=u.width()),t.css(r),n}function v(n,t){var r,u,i;return t.indexId===-1&&!t.idField||t.multiWord?n:(r=n.css("background-color").replace(/ /g,"").split(",",3).join(","),u=t.inputBgColor||"rgba(255,255,255,0.1)",i=t.inputWarnColor||"rgba(255,255,0,0.1)",o(n)||!n.val())?n.css("background",u):(~i.indexOf(r)||n.trigger("onUnsetSelectValue").css("background",i),n)}function d(n,t,i){var f=n.parent().find("tbody tr."+i.listHoverCSS),r,u;f.length&&(r=(f.index()+3)*f.height(),u=Number(t.css("max-height").replace("px","")),r=r>u||t.scrollTop()>u?r-u:0,t.scrollTop(r))}function g(n,t){n.find("tr."+t.listHoverCSS).removeClass(t.listHoverCSS)}function ot(n,r,f){return!r.length||n.data(u)?t:(n.data(u,{options:f}),i)}function nt(n){var r=i;for(var u in n)if(u==="value"){r=t;break}return r?(et("返回数据格式错误!"),t):n.value.length?n:t}function y(t,i){var r=i.effectiveFields;return!(t==="__index"||r.length&&!~n.inArray(t,r))}function st(t,i){return~n.inArray(t,i.searchFields)}function tt(n,t,i,r){i.html('<div style="padding:10px 5px 5px">'+n+"<\/div>").show();h(t,i,r)}function p(n,t,i){var r=n.parent().find("ul:eq(0)"),c,s,u,o=0,p,e=['<table class="table table-condensed table-sm" style="margin:0">'],l,a,v,f;if(!t||!(c=t.value.length))return i.emptyTip?tt(i.emptyTip,n,r,i):r.empty().hide(),n;if(v=t.value,i._lastData&&JSON.stringify(i._lastData.value)===JSON.stringify(v)&&r.find("tr").length===c)return r.show(),h(n,r,i),n;if(i._lastData=t,i.showHeader){e.push("<thead><tr>");for(u in v[0])y(u,i)&&(e.push("<th>",i.effectiveFieldsAlias[u]||u,o===0?"("+c+")":"","<\/th>"),o++);e.push("<\/tr><\/thead>")}for(e.push("<tbody>"),s=0;s<c;s++){o=0;p=[];f=v[s];l=f[i.idField]||"";a=f[i.keyField]||"";for(u in f)(a||i.indexKey!==o||(a=f[u]),l||i.indexId!==o||(l=f[u]),o++,y(u,i))&&p.push('<td data-name="',u,'">',f[u],"<\/td>");e.push('<tr data-index="',f.__index||s,'" data-id="',l,'" data-key="',a,'">',p.join(""),"<\/tr>")}return e.push("<\/tbody><\/table>"),r.html(e.join("")).show(),setTimeout(function(){if(!ft){var n=r.find("table:eq(0)"),t=0,i=0;r.height()<n.height()&&Number(r.css("min-width").replace("px",""))<r.width()&&(t=18,i=20);r.css("padding-right",t);n.css("margin-bottom",i)}},301),h(n,r,i),n}function it(i,r){var f,u,e,o;if(r=r||"",f=i._preAjax,f&&f.abort&&f.readyState!==4&&f.abort(),u={type:"GET",dataType:i.jsonp?"jsonp":"json",timeout:5e3},i.jsonp&&(u.jsonp=i.jsonp),o=i.fnAdjustAjaxParam,n.isFunction(o)){if(e=o(r,i),t===e)return;n.extend(u,e)}return u.url=function(){if(!r||u.data)return u.url||i.url;var n="?";return/=$/.test(i.url)?n="":/\?/.test(i.url)&&(n="&"),i.url+n+r}(),i._preAjax=n.ajax(u).done(function(n){i.data=i.fnProcessData(n)}).fail(function(n){i.fnAjaxFail&&i.fnAjaxFail(n,i)})}function ht(t,i,r,u){return r=n.trim(r),u.ignorecase&&(t=t.toLocaleLowerCase(),r=r.toLocaleLowerCase()),r&&(y(i,u)||st(i,u))&&(~r.indexOf(t)||u.twoWayMatch&&~t.indexOf(r))}function ct(t,i,r,u){var f,c,o={value:[]},e,s,l,a=u.fnPreprocessKeyword,h;if(t=t||"",n.isFunction(a)&&(t=a(t,u)),u.url)u.searchingTip&&(h=setTimeout(function(){tt(u.searchingTip,i,i.parent().find("ul"),u)},600)),it(u,t).done(function(n){r(i,u.data,u);i.trigger(b,n);u.getDataMethod==="firstByUrl"&&(u.url=null)}).always(function(){h&&clearTimeout(h)});else{if(f=u.data,c=nt(f),c)if(t){for(l=f.value.length,e=0;e<l;e++)for(s in f.value[e])if(f.value[e][s]&&ht(t,s,f.value[e][s]+"",u)){o.value.push(f.value[e]);o.value[o.value.length-1].__index=e;break}}else o=f;r(i,o,u)}}function lt(n){return nt(n)}function at(t,i){var r=t.prev("i.clearable");return i.clearable&&!r.length&&(r=n('<i class="clearable glyphicon glyphicon-remove"><\/i>').prependTo(t.parent())),r.css({position:"absolute",top:12,right:i.showBtn?(t.next(".input-group-btn").width()||33)+2:12,zIndex:4,cursor:"pointer",fontSize:12}).hide()}var ut="0.1.20",l=n(window),w="ActiveXObject"in window,a,s=navigator.userAgent.match(/Chrome\/(\d+)/),rt,c;s&&(s=Number(s[1]));var ft=w||s>51,u="bsSuggest",b="onDataRequestSuccess",r="disabled",i=!0,t=!1;rt={url:null,jsonp:null,data:{value:[]},indexId:0,indexKey:0,idField:"",keyField:"",autoSelect:i,allowNoKeyword:i,getDataMethod:"firstByUrl",delayUntilKeyup:t,ignorecase:t,effectiveFields:[],effectiveFieldsAlias:{},searchFields:[],twoWayMatch:i,multiWord:t,separator:",",delay:300,emptyTip:"",searchingTip:"搜索中...",autoDropup:t,autoMinWidth:t,showHeader:t,showBtn:i,inputBgColor:"",inputWarnColor:"rgba(255,0,0,.1)",listStyle:{"padding-top":0,"max-height":"375px","max-width":"800px",overflow:"auto",width:"auto",transition:"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"},listAlign:"left",listHoverStyle:"background: #07d; color:#fff",listHoverCSS:"jhover",clearable:t,keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyEnter:13,fnProcessData:lt,fnGetData:ct,fnAdjustAjaxParam:null,fnPreprocessKeyword:null,fnAjaxFail:null};c={init:function(s){var c=this;return s=s||{},undefined===s.showHeader&&s.effectiveFields&&s.effectiveFields.length>1&&(s.showHeader=i),s=n.extend(i,{},rt,s),s.processData&&(s.fnProcessData=s.processData),s.getData&&(s.fnGetData=s.getData),s.getDataMethod==="firstByUrl"&&s.url&&!s.delayUntilKeyup&&it(s).done(function(n){s.url=null;c.trigger(b,n)}),n("#"+u).length||n("head:eq(0)").append('<style id="'+u+'">.'+s.listHoverCSS+"{"+s.listHoverStyle+"}<\/style>"),c.each(function(){var u=n(this),l=u.parent(),y=at(u,s),w,b,c=l.find("ul:eq(0)");if(!ot(u,c,s)){console.warn("不是一个标准的 bootstrap 下拉式菜单或已初始化:",u);return}s.showBtn||(u.css("border-radius","4px"),l.css("width","100%").find(".btn:eq(0)").hide());u.removeClass(r).prop(r,t).attr("autocomplete","off");c.css(s.listStyle);s.inputBgColor||(s.inputBgColor=u.css("background-color"));u.on("keydown",function(n){var t,i;if(c.is(":visible")){if(t=c.find("."+s.listHoverCSS),i="",g(c,s),n.keyCode===s.keyDown){if(t.length?t.next().length?i=f(t.next().mouseover()):s.autoSelect&&o(u,"").val(e(u)):i=f(c.find("tbody tr:first").mouseover()),d(u,c,s),!s.autoSelect)return}else if(n.keyCode===s.keyUp){if(t.length?t.prev().length?i=f(t.prev().mouseover()):s.autoSelect&&o(u,"").val(e(u)):i=f(c.find("tbody tr:last").mouseover()),d(u,c,s),!s.autoSelect)return}else n.keyCode===s.keyEnter?(i=f(t),c.hide()):o(u,"");k(u,i,s)}}).on("compositionstart",function(){a=i}).on("compositionend",function(){a=t}).on("keyup input paste",function(t){var i;if(t.keyCode&&v(u,s),~n.inArray(t.keyCode,[s.keyDown,s.keyUp,s.keyEnter])){u.val(u.val());return}clearTimeout(b);b=setTimeout(function(){a||(i=u.val(),n.trim(i)&&i===e(u))||(e(u,i),s.multiWord&&(i=i.split(s.separator).reverse()[0]),i.length||s.allowNoKeyword)&&s.fnGetData(n.trim(i),u,p,s)},s.delay||300)}).on("focus",function(){h(u,c,s)}).on("blur",function(){w||c.css("display","")}).on("click",function(){var t=u.val();if(n.trim(t)&&t===e(u)&&c.find("table tr").length)return c.show();c.is(":visible")||(s.multiWord&&(t=t.split(s.separator).reverse()[0]),t.length||s.allowNoKeyword)&&s.fnGetData(n.trim(t),u,p,s)});l.find(".btn:eq(0)").attr("data-toggle","").click(function(){var n="none";return c.css("display")===n&&(n="block",s.url?(u.click().focus(),c.find("tr").length||(n="none")):p(u,s.data,s)),c.css("display",n),t});c.mouseenter(function(){w=1;u.blur()}).mouseleave(function(){w=0;u.focus()}).on("mouseenter","tbody tr",function(){return g(c,s),n(this).addClass(s.listHoverCSS),t}).on("mousedown","tbody tr",function(){var t=f(n(this));k(u,t,s);e(u,t.key);v(u,s);c.hide()});y.length&&(y.click(function(){o(u,"").val("");v(u,s)}),l.mouseenter(function(){u.prop(r)||y.show()}).mouseleave(function(){y.hide()}))})},show:function(){return this.each(function(){n(this).click()})},hide:function(){return this.each(function(){n(this).parent().find("ul:eq(0)").css("display","")})},disable:function(){return this.each(function(){n(this).attr(r,i).parent().find(".btn:eq(0)").prop(r,i)})},enable:function(){return this.each(function(){n(this).attr(r,t).parent().find(".btn:eq(0)").prop(r,t)})},destroy:function(){return this.each(function(){n(this).off().removeData(u).removeAttr("style").parent().find(".btn:eq(0)").off().show().attr("data-toggle","dropdown").prop(r,t).next().css("display","").off()})},version:function(){return ut}};n.fn[u]=function(r){if(typeof r=="string"&&c[r]){var f=i;return(this.each(function(){if(!n(this).data(u))return f=t}),!f&&"init"!==r&&"version"!==r)?this:c[r].apply(this,[].slice.call(arguments,1))}return c.init.apply(this,arguments)}});